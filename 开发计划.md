# 云容器监控平台 - 开发计划

## 项目概述
开发一个统一的多云容器监控平台，支持 Zeabur、Render、Koyeb、Vercel 四个平台的容器状态监控和管理。

**技术栈**: Node.js + Express + Vue.js 3 + SQLite + JWT

---

## 开发阶段划分

### Phase 1: 基础框架搭建（第 1-2 周）

#### 任务 #1: 搭建后端 Express 项目基础框架
**状态**: 待开始
**依赖**: 无
**工作内容**:
- 创建 backend 目录结构
- 初始化 package.json
- 安装核心依赖（express, jsonwebtoken, bcrypt, sqlite3, cors, dotenv）
- 配置 ESM 模块
- 创建基础的 app.js 入口文件

#### 任务 #2: 初始化 SQLite 数据库和模型
**状态**: 待开始
**依赖**: 任务 #1
**工作内容**:
- 创建数据库配置文件
- 编写 SQL 初始化脚本创建 5 张表（users, platforms, containers, alerts, alert_configs）
- 实现数据库连接和基础 ORM 封装

#### 任务 #3: 实现用户认证系统
**状态**: 待开始
**依赖**: 任务 #2
**工作内容**:
- 实现用户注册、登录、JWT Token 生成和验证
- 创建 auth 中间件
- 实现密码加密（bcrypt）
- 编写 auth 路由（/api/auth/register, /api/auth/login, /api/auth/profile）

#### 任务 #12: 搭建前端 Vue 项目基础框架
**状态**: 待开始
**依赖**: 无
**工作内容**:
- 创建 frontend 目录
- 使用 Vite 初始化 Vue 3 项目
- 安装依赖（vue-router, pinia, axios, element-plus）
- 配置路由和状态管理
- 创建基础布局组件

#### 任务 #18: 实现错误处理和日志系统
**状态**: 待开始
**依赖**: 任务 #1
**工作内容**:
- 创建统一错误处理中间件
- 实现日志记录工具（使用 winston）
- 实现 API 请求日志
- 实现错误日志文件存储
- 前端实现全局错误提示

---

### Phase 2: 平台适配器开发（第 2-4 周）

#### 任务 #4: 实现 Zeabur 平台适配器
**状态**: 待开始
**依赖**: 任务 #1
**工作内容**:
- 创建 ZeaburAdapter 类
- 实现 GraphQL 查询
- 完成 listContainers, getContainer, restartContainer, stopContainer, deleteContainer, getContainerLogs 方法
- 处理 Zeabur API 的特殊响应格式

#### 任务 #5: 实现 Render 平台适配器
**状态**: 待开始
**依赖**: 任务 #1
**工作内容**:
- 创建 RenderAdapter 类
- 实现 REST API 调用
- 完成所有标准适配器方法
- 处理 Render 的服务状态映射和错误处理

#### 任务 #6: 实现 Koyeb 平台适配器
**状态**: 待开始
**依赖**: 任务 #1
**工作内容**:
- 创建 KoyebAdapter 类
- 实现 REST API 调用
- 完成所有标准适配器方法
- 处理 Koyeb 的服务重部署逻辑

#### 任务 #7: 实现 Vercel 平台适配器
**状态**: 待开始
**依赖**: 任务 #1
**工作内容**:
- 创建 VercelAdapter 类
- 实现 REST API 调用
- 完成所有标准适配器方法
- 处理 Vercel 的项目和部署概念差异

---

### Phase 3: 后端 API 开发（第 4-6 周）

#### 任务 #8: 实现平台管理 API
**状态**: 待开始
**依赖**: 任务 #3, #4, #5, #6, #7
**工作内容**:
- 创建 platforms 路由
- 实现平台配置的增删改查接口
- 实现 API 密钥的 AES-256 加密存储和解密
- 实现平台连接测试接口

#### 任务 #9: 实现容器管理 API
**状态**: 待开始
**依赖**: 任务 #8
**工作内容**:
- 创建 containers 路由
- 实现容器列表查询、详情获取、操作接口（重启、停止、删除）
- 实现日志查看接口
- 实现批量操作接口

---

### Phase 4: 监控与告警服务（第 6-7 周）

#### 任务 #10: 实现监控服务和定时任务
**状态**: 待开始
**依赖**: 任务 #9
**工作内容**:
- 创建 monitorService
- 使用 node-cron 实现定时轮询（每 5 分钟）
- 实现容器状态检测和对比逻辑
- 实现状态变化记录
- 集成所有平台适配器

#### 任务 #11: 实现告警服务
**状态**: 待开始
**依赖**: 任务 #10
**工作内容**:
- 创建 alertService
- 实现告警规则判断
- 实现邮件通知（使用 nodemailer）
- 实现 Webhook 通知
- 创建告警配置管理 API

---

### Phase 5: 前端界面开发（第 7-10 周）

#### 任务 #13: 实现前端登录和认证功能
**状态**: 待开始
**依赖**: 任务 #12
**工作内容**:
- 创建登录页面
- 实现登录表单和验证
- 创建 authStore 管理认证状态
- 实现 axios 拦截器自动添加 JWT Token
- 实现 Token 过期自动跳转登录

#### 任务 #14: 实现前端仪表盘页面
**状态**: 待开始
**依赖**: 任务 #13
**工作内容**:
- 创建 Dashboard 页面
- 实现概览统计（总容器数、运行中、异常等）
- 实现平台状态卡片展示
- 实现最近告警列表

#### 任务 #15: 实现前端平台管理页面
**状态**: 待开始
**依赖**: 任务 #13
**工作内容**:
- 创建平台管理页面
- 实现平台配置列表展示
- 实现添加/编辑/删除平台配置表单
- 实现平台连接测试功能
- 实现 API 密钥的安全输入

#### 任务 #16: 实现前端容器列表和操作页面
**状态**: 待开始
**依赖**: 任务 #13
**工作内容**:
- 创建容器列表页面
- 实现容器表格展示（支持筛选、排序）
- 实现容器操作按钮（重启、停止、删除）
- 实现批量操作功能
- 实现日志查看弹窗

#### 任务 #17: 实现前端告警中心页面
**状态**: 待开始
**依赖**: 任务 #13
**工作内容**:
- 创建告警中心页面
- 实现告警列表展示
- 实现告警配置管理（邮件、Webhook）
- 实现告警规则设置
- 实现告警历史查询

---

### Phase 6: 测试与优化（第 10-11 周）

#### 任务 #19: 编写单元测试和集成测试
**状态**: 待开始
**依赖**: 任务 #11, #16, #17
**工作内容**:
- 为平台适配器编写单元测试
- 为 API 接口编写集成测试
- 测试认证流程
- 测试监控服务
- 测试告警触发
- 确保核心功能稳定性

#### 任务 #20: 性能优化和安全加固
**状态**: 待开始
**依赖**: 任务 #19
**工作内容**:
- 实现 API 请求限流（express-rate-limit）
- 添加 CORS 配置
- 实现请求缓存机制
- 优化数据库查询
- 添加 SQL 注入防护
- 实现 XSS 防护

---

### Phase 7: 部署上线（第 11-12 周）

#### 任务 #21: 编写部署文档和 Docker 配置
**状态**: 待开始
**依赖**: 任务 #20
**工作内容**:
- 编写 README.md 使用说明
- 创建 .env.example 环境变量模板
- 编写 Dockerfile 和 docker-compose.yml
- 编写部署步骤文档
- 创建数据库初始化脚本

---

## 任务依赖关系图

```
任务 #1 (后端框架)
  ├─→ 任务 #2 (数据库)
  │     └─→ 任务 #3 (认证)
  ├─→ 任务 #4 (Zeabur 适配器)
  ├─→ 任务 #5 (Render 适配器)
  ├─→ 任务 #6 (Koyeb 适配器)
  ├─→ 任务 #7 (Vercel 适配器)
  │     └─→ 任务 #8 (平台管理 API)
  │           └─→ 任务 #9 (容器管理 API)
  │                 └─→ 任务 #10 (监控服务)
  │                       └─→ 任务 #11 (告警服务)
  └─→ 任务 #18 (错误处理)

任务 #12 (前端框架)
  └─→ 任务 #13 (前端登录)
        ├─→ 任务 #14 (仪表盘)
        ├─→ 任务 #15 (平台管理页面)
        ├─→ 任务 #16 (容器列表页面)
        └─→ 任务 #17 (告警中心页面)

任务 #11, #16, #17
  └─→ 任务 #19 (测试)
        └─→ 任务 #20 (优化)
              └─→ 任务 #21 (部署)
```

---

## 开发里程碑

### 里程碑 1: 基础框架完成（第 2 周末）
- ✅ 后端项目结构搭建完成
- ✅ 前端项目结构搭建完成
- ✅ 数据库初始化完成
- ✅ 用户认证系统可用

### 里程碑 2: 平台适配器完成（第 4 周末）
- ✅ 四个平台适配器全部实现
- ✅ 适配器单元测试通过
- ✅ 平台管理 API 可用

### 里程碑 3: 核心功能完成（第 7 周末）
- ✅ 容器管理 API 完成
- ✅ 监控服务运行正常
- ✅ 告警服务可用

### 里程碑 4: 前端界面完成（第 10 周末）
- ✅ 所有前端页面开发完成
- ✅ 前后端联调通过
- ✅ 基本功能可演示

### 里程碑 5: 项目上线（第 12 周末）
- ✅ 测试完成
- ✅ 性能优化完成
- ✅ 部署文档完善
- ✅ 项目正式上线

---

## 当前进度

**当前阶段**: Phase 1 - 基础框架搭建
**下一步任务**: 任务 #1 - 搭建后端 Express 项目基础框架
**整体进度**: 0/21 任务完成 (0%)

---

## 风险与应对

### 风险 1: 平台 API 文档不完整
**应对**: 优先实现核心功能，非关键功能可后续补充

### 风险 2: API 调用频率限制
**应对**: 实现请求队列和缓存机制，降低调用频率

### 风险 3: 不同平台 API 差异大
**应对**: 使用适配器模式隔离差异，统一接口

### 风险 4: 开发时间超预期
**应对**: 采用敏捷开发，优先实现 MVP，逐步迭代

---

## 备注

- 每周进行一次进度回顾和计划调整
- 优先保证核心功能（监控、告警）的稳定性
- 前后端可并行开发，定期联调
- 代码提交前必须通过 ESLint 检查
- 关键功能必须编写单元测试
